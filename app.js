angular.module("intranet",["ngRoute","ngResource","angular-storage","routeStyles","diretivas"]).config(function($routeProvider){$routeProvider.when("/",{templateUrl:"partials/login.html",controller:"AcessoController",css:"css/login.css"}),$routeProvider.when("/embaixada-amor",{templateUrl:"partials/embaixada-amor.html",css:"css/inicio.css"}),$routeProvider.when("/atestado-matricula",{templateUrl:"partials/atestado-matricula.html",css:"css/inicio.css"}),$routeProvider.when("/trocar-senha",{templateUrl:"partials/trocar-senha.html",css:"css/inicio.css"}),$routeProvider.when("/biblioteca",{templateUrl:"partials/biblioteca.html",controller:"LivrosController",css:["css/biblioteca.css","css/inicio.css"]})}),angular.module("intranet").controller("AcessoController",function($scope,AcessoService,store,$location){$scope.acesso={},$scope.invalido=!1,$scope.loading=!1,$scope.login=function(){$scope.invalido=!1,$scope.formulario.$valid&&($scope.loading=!0,AcessoService.login($scope.acesso).then(function(response){store.set("access_token",response.dados.access_token),$location.path("/biblioteca")}).catch(function(erro){$scope.invalido=!0,$scope.loading=!1,console.log(erro),$scope.formulario.$submitted=!1}))}}),angular.module("intranet").controller("LivroController",function($scope){$scope.livro=[]}),angular.module("intranet").controller("LivrosController",function($scope,LivroService,EmprestimoService){$scope.livros=[],$scope.meusLivros=[],$scope.emprestimo=function(){var ids=_.map($scope.livrosSelecionados,function(livro){return livro.id_livro});EmprestimoService.emprestimo(ids).then(function(response){$scope.mensagem=response.dados.message,$scope.classe="alert-success",_.each($scope.livrosSelecionados,function(livroSelecionado){_.remove($scope.livros,function(livro){return livro.id_livro===livroSelecionado.id_livro})});var data_emprestimo=moment().format("YYYY-MM-DD"),data_devolucao=moment().add(15,"d").format("YYYY-MM-DD");_.each($scope.livrosSelecionados,function(livro){livro.data_emprestimo=data_emprestimo,livro.data_devolucao=data_devolucao,$scope.meusLivros.push(livro)})}).catch(function(error){$scope.mensagem=error.dados.message,$scope.classe="alert-danger"})},$scope.confirmacao=function(){$scope.emprestar=!0,$scope.livrosSelecionados=_.filter($scope.livros,function(livro){return livro.selecionado})},$scope.cancelar=function(){$scope.emprestar=!1},LivroService.getLivrosDisponiveis().then(function(response){$scope.livros=response.livros}).catch(function(error){console.log(error.message)}),EmprestimoService.getEmprestimos().then(function(response){$scope.hoje=moment().format("YYYY-MM-DD"),$scope.meusLivros=response.emprestimos}).catch(function(error){console.log(error.message)})}),angular.module("intranet").controller("SimuladoController",function($scope){$scope.simulado=[]}),angular.module("intranet").controller("SimuladosController",function($scope){$scope.simulados=[]}),angular.module("intranet").controller("UsuarioController",function($scope){$scope.usuarios=[]}),angular.module("intranet").controller("UsuariosController",function($scope){$scope.usuarios=[]}),angular.module("diretivas",[]).directive("meuFooter",function(){return{restrict:"E",templateUrl:"js/directives/templates/meu-footer.html"}}).directive("meuMenu",function(){return{restrict:"E",templateUrl:"js/directives/templates/meu-menu.html"}}),angular.module("intranet").factory("AuthInterceptor",function($location,store,$q){return{request:function(config){return config.headers=config.headers||{},store.get("access_token")&&(config.headers.Authorization="Bearer "+store.get("access_token")),config},responseError:function(response){return 401!==response.status&&403!==response.status||$location.path("/"),$q.reject(response)}}}).config(function($httpProvider){$httpProvider.interceptors.push("AuthInterceptor")}),angular.module("intranet").factory("AcessoService",function($resource,$q,store){var grant_type="password",client_id="4",client_secret="e3wxnL5J6OSCCs54YZfNdHBpdFzlpY0K1YHAeAMA",scope="*",loginResource=$resource("http://dev.einsteinfloripa.xyz/oauth/token",{},{save:{method:"POST",header:{"Content-Type":"application/json",Accept:"application/json"}}});return{login:function(credentials){return credentials.scope=scope,credentials.grant_type=grant_type,credentials.client_id=client_id,credentials.client_secret=client_secret,$q(function(resolve,reject){loginResource.save(credentials,function(dados){resolve({dados:dados})},function(erro){reject({message:erro})})})},getToken:function(){return store.get("access_token")}}}),angular.module("intranet").factory("EmprestimoService",function($resource,$q){var livroResource=$resource("http://dev.einsteinfloripa.xyz/api/emprestimos");return{getEmprestimos:function(){return $q(function(resolve,reject){livroResource.query(function(dados){resolve({emprestimos:dados})},function(erro){reject({dados:erro})})})},emprestimo:function(ids){return $q(function(resolve,reject){livroResource.save({ids:JSON.stringify(ids)},function(dados){resolve({dados:dados})},function(erro){reject({dados:erro})})})}}}),angular.module("intranet").factory("LivroService",function($resource,$q){var livroResource=$resource("http://dev.einsteinfloripa.xyz/api/livros/:idLivro",{},{getDisponiveis:{method:"GET",url:"http://dev.einsteinfloripa.xyz/api/livros/disponiveis",isArray:!0}});return{getLivros:function(){return $q(function(resolve,reject){livroResource.query(function(dados){resolve({livros:dados})},function(erro){reject({dados:erro})})})},getLivrosDisponiveis:function(){return $q(function(resolve,reject){livroResource.getDisponiveis(function(dados){resolve({livros:dados})},function(erro){reject({dados:erro})})})}}}),angular.module("intranet").factory("SimuladoService",function($resource,$q){$resource("http://dev.einsteinfloripa.xyz/api/simulados/:idSimulado",null)}),angular.module("intranet").factory("UsuarioService",function($resource,$q){$resource("http://dev.einsteinfloripa.xyz/api/usuarios/:idUsuario",null)});